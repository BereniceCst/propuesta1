{{#> 
layouts/main 
title="Generate Stack" 
pagename="icons_stack_generate" 
category_1="Font Icons" 
category_2="Stack Icons" 
heading="Stack Icons: <span class='fw-300'>Generate Stack</span> <sup class='badge badge-success fw-500'>ADDON</sup>" 
pagedescription="Generate icons"
}}

{{#*inline "head-block"}}
<link rel="stylesheet" media="screen, print" href="css/fa-regular.min.css">
<link rel="stylesheet" media="screen, print" href="css/fa-solid.min.css">
<link rel="stylesheet" media="screen, print" href="css/fa-brands.min.css">
<link rel="stylesheet" media="screen, print" href="css/ng-icons.min.css">
{{/inline}}

{{#*inline "content-block"}}

<div class="">
    

    <div class="card">
        <div class="card-body">
            <h3 class="mb-4">
                Unique
                <span class="fw-300">Icon</span>
                <small>
                  Design your unique stack icon
                </small>
            </h3>
            <div class="d-flex row">
                <div class="col-12 col-xl-auto">
                    <div class="d-flex align-items-center justify-content-center position-relative w-100 mb-4 mb-xl-0" style="font-size: 250px; min-width: 301px; height: 351px; background: url(img/backgrounds/bg-5.png) #fff; border-left:0; border-top:0; ">

                        <h6 class="fw-300 position-absolute pos-top pos-left m-2 bg-fusion-100 p-2 rounded fs-sm opacity-70">Preview</h6>
                        <div id="icon-construct" class="icon-stack m-0 p-0"></div>

                    </div>
                </div>
                <div class="flex-1 col-12 col-xl-auto">
                    <ul class="mb-2 p-0 list-unstyled" id="construct-wrap"></ul>

                    <div class="row">
                        <div class="col-12 text-right">
                            <a href="#" class="btn btn-success">
                                Copy Icon
                            </a>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>

</div>

{{/inline}}

{{#*inline "scripts-block"}}

<script>

var fa_icon,
    fa_brand,
    ni_icon,
    ni_base,
    ng_textColors,
    fa_icon_URL = "fa-icon-list.json",
    fa_brand_URL = "fa-brand-list.json",
    ni_icon_URL = "ng-icon-list.json",
    ni_base_URL = "ng-icon-base.json",
    ng_textColors_URL = "ng-text-colors.json",
    prefix = ["base", "fal", "fas", "far", "fab", "ni"],
    iconSize = ["icon-stack-3x", "icon-stack-2x", "icon-stack-1x"],
    layers =  getUrlParameter('layers') || 3,
    formatedDOMElms = [],
    formattedDOMIcon = [],
    formatPrefix = [],
    formatOpacityValue = [],
    formatIconSize = [],
    formatTextColors = [],
    format_fa_icon = [],
    format_fa_brand = [],
    format_ni_icon = [],
    format_ni_base = [];

$.when(
    $.getJSON(fa_icon_URL, function(data) {
        fa_icon = data;
    }),
    $.getJSON(fa_brand_URL, function(data) {
        fa_brand = data;
    }),
    $.getJSON(ni_icon_URL, function(data) {
        ni_icon = data;
    }),
    $.getJSON(ni_base_URL, function(data) {
        ni_base = data;
    }),
    $.getJSON(ng_textColors_URL, function(data) {
        ng_textColors = data;
    })
).then(function() {
    if (fa_icon && fa_brand && ni_icon && ni_base && ng_textColors) {

        //formatPrefix
        jQuery.each(prefix, function(index, item) {
            formatPrefix.push($('<option></option>').attr("value", item).text(item))
        });
        //formatIconSize
        jQuery.each(iconSize, function(index, item) {
            formatIconSize.push($('<option></option>').attr("value", item).text("size-" + item.slice(11)))
        });
        //formatTextColors
        jQuery.each(ng_textColors, function(index, item) {
            formatTextColors.push($('<option></option>').attr("value", item).addClass("bg" + item.slice(5)).text(item.slice(6)))
        });
        //format_fa_icon
        jQuery.each(fa_icon, function(index, item) {
            format_fa_icon.push('<option value="fa' + item + '" data-icon-class="' + item + '">' + item.slice(1) + '</option>')
        });
        //fa_brand
        jQuery.each(fa_brand, function(index, item) {
            format_fa_brand.push('<option value="fa' + item + '" data-icon-class="' + item + '">' + item.slice(1) + '</option>')
        });
        //format_ni_icon
        jQuery.each(ni_icon, function(index, item) {
            format_ni_icon.push('<option value="ni' + item + '" data-icon-class="' + item + '">' + item.slice(1) + '</option>')
        });
        //format_ni_base
        jQuery.each(ni_base, function(index, item) {
            format_ni_base.push('<option value="' + item + '" data-icon-class="' + item + '">' + item + '</option>')
        });

        // create layers
        for (var i = 0; i < layers; i++) {

            /* pushing icons */
            formattedDOMIcon.push('<i data-icon-select="' + i + '" class=""></i>')

            /* pushing controls */
            formatedDOMElms.push('<li id="' + i + '" class="pt-2 pb-2 pl-0 pr-3 bg-subtlelight-fade mb-3 rounded border-faded" data-layer-target="' + i + '">\
                                    <div class="d-flex flex-row">\
                                        <div class="width-5 js-move-trigger">\
                                            <a href="#" class="h-100 w-100 d-flex align-items-center justify-content-center text-dark opacity-40 cursor move"><i class="fal fa-arrows-v fa-2x"></i></a>\
                                        </div>\
                                        <div class="flex-1 row no-gutters">\
                                            <div class="col-12">\
                                                <h4 class="frame-heading m-0 mb-1">Layer ' + i + '</h4>\
                                            </div>\
                                            <div class="col-sm-2">\
                                                <div class="form-group mr-2 mb-0">\
                                                    <select class="js-icon-prefix js-select-trigger custom-select w-100"></select>\
                                                    <small class="form-text">\
                                                        <span class="text-muted fw-300">Icon prefix</span>\
                                                    </small>\
                                                </div>\
                                            </div>\
                                            <div class="col-sm-3">\
                                                <div class="form-group mr-2 mb-0">\
                                                    <select data-icon-target="' + i + '" class="js-icon-class js-select-trigger custom-select w-100"></select>\
                                                    <small class="form-text">\
                                                        <span class="text-muted fw-300">Choose icon type</span>\
                                                    </small>\
                                                </div>\
                                            </div>\
                                            <div class="col-sm-3">\
                                                <div class="form-group mr-2 mb-0">\
                                                    <select class="js-icon-color js-select-trigger custom-select w-100"></select>\
                                                    <small class="form-text">\
                                                        <span class="text-muted fw-300">Select icon color</span>\
                                                    </small>\
                                                </div>\
                                            </div>\
                                            <div class="col-sm-2">\
                                                <div class="form-group mr-2 mb-0">\
                                                    <select class="js-icon-size js-select-trigger custom-select w-100"></select>\
                                                    <small class="form-text">\
                                                        <span class="text-muted fw-300">Icon size</span>\
                                                    </small>\
                                                </div>\
                                            </div>\
                                            <div class="col-sm-2">\
                                                <div class="form-group mb-0">\
                                                    <input type="range" min="5" max="100" step="5" value="100" class="w-100 js-icon-opacity js-select-trigger">\
                                                    <small class="form-text m-0">\
                                                       <span class="text-muted fw-300">Opacity level</span>\
                                                    </small>\
                                                </div>\
                                            </div>\
                                            <div class="col-sm-12 mt-2">\
                                                <a class="" data-toggle="collapse" href="#advance-' + i + '" role="button" aria-expanded="false" aria-controls="advance-' + i + '">\
                                                    Advance controls\
                                                </a>\
                                            </div>\
                                            <div class="collapse" id="advance-' + i + '">\
                                                <div class="form-group mb-0 mr-2">\
                                                    <div class="custom-control d-inline-flex custom-checkbox m-0 mr-4">\
                                                        <input id="js-animate-' + i + '" type="checkbox" class="custom-control-input">\
                                                        <label class="custom-control-label" for="js-animate-' + i + '">Animate</label>\
                                                    </div>\
                                                    <div class="custom-control d-inline-flex custom-checkbox m-0 mr-4">\
                                                        <input id="js-flip-horizontal' + i + '" type="checkbox" class="custom-control-input">\
                                                        <label class="custom-control-label" for="js-flip-horizontal' + i + '">Flip Horizontal</label>\
                                                    </div>\
                                                    <div class="custom-control d-inline-flex custom-checkbox m-0 mr-4">\
                                                        <input id="js-flip-vertical' + i + '" type="checkbox" class="custom-control-input">\
                                                        <label class="custom-control-label" for="js-flip-vertical' + i + '">Flip Vertical</label>\
                                                    </div>\
                                                </div>\
                                            </div>\
                                        </div>\
                                    </div>\
                                </li>');

        }

        $('#construct-wrap').append(formatedDOMElms.reverse().join(" "));
        $('#icon-construct').append(formattedDOMIcon.join(" "));
        $("select.js-icon-prefix").append(formatPrefix);
        $("select.js-icon-size").empty().append(formatIconSize.reverse());
        $("select.js-icon-class").empty().append(format_ni_base.reverse());
        $("select.js-icon-color").empty().append(formatTextColors);

        //pre-select
        $('[data-layer-target="0"] .js-icon-size').val('icon-stack-3x');
        $('[data-layer-target="1"] .js-icon-size').val('icon-stack-2x');
        $('[data-layer-target="0"] .js-icon-color').val('color-primary-500');
        $('[data-layer-target="1"] .js-icon-color').val('color-primary-300');

        //on prefix change update icon select
        $(document).on('change', '.js-icon-prefix', function() {
            var selectValue = $(this).val();
            if (selectValue == 'fal' || selectValue == 'fas' || selectValue == 'far') {
                $(this).closest('[data-layer-target]').find('.js-icon-class').empty().append(format_fa_icon);
            } else if (selectValue == 'ni') {
                $(this).closest('[data-layer-target]').find('.js-icon-class').empty().append(format_ni_icon);
            } else if (selectValue == 'base') {
                $(this).closest('[data-layer-target]').find('.js-icon-class').empty().append(format_ni_base);
            } else if (selectValue == 'fab') {
                $(this).closest('[data-layer-target]').find('.js-icon-class').empty().append(format_fa_brand);
            }
        })

        // runIconGenerator
        var runIconGenerator = function(id) {
            var uID = $('[data-layer-target="' + id + '"]');
            var iconPrefix = uID.find('select.js-icon-prefix').val();
            var iconClass = uID.find('select.js-icon-class').val();
            var iconSize = uID.find('select.js-icon-size').val();
            var iconOpacity = uID.find('input.js-icon-opacity').val();
            var iconColor = uID.find('select.js-icon-color').val();

            //console.log(iconOpacity)

            $('#icon-construct').find('[data-icon-select="' + id + '"]').removeClass().addClass(iconPrefix + " " + iconClass + " " + iconSize + " " + "opacity-" + iconOpacity + " " + iconColor);

            uID.find('select.js-icon-color').removeClassPrefix('bg-').addClass('bg' + iconColor.slice(5));
        };

        //select trigger function
        $(document).on('change', '.js-select-trigger', function() {
            var uniqueID = $(this).closest('[data-layer-target]').attr('data-layer-target');
            runIconGenerator(uniqueID);
        })


        //sample

        $('[data-layer-target="0"] .js-icon-class').val('base-7').trigger('change');
        $('[data-layer-target="1"] .js-icon-class').val('base-7').trigger('change');
        $('[data-layer-target="2"] .js-icon-prefix').val('fal').trigger('change');
        $('[data-layer-target="2"] .js-icon-class').val('fa-car').trigger('change');


        var changeOrder = function (){

            var bundleNewElms = [];

            $('#construct-wrap li').each(function() {
                $this = $(this)
                var uID = $this.attr('data-layer-target');
                var iconPrefix = $this.find('select.js-icon-prefix').val();
                var iconClass = $this.find('select.js-icon-class').val();
                var iconSize = $this.find('select.js-icon-size').val();
                var iconOpacity = $this.find('input.js-icon-opacity').val();
                var iconColor = $this.find('select.js-icon-color').val();

                bundleNewElms.push('<i data-icon-select="' + uID + '" class="'+ iconPrefix + " " + iconClass + " " + iconSize + " " + "opacity-" + iconOpacity + " " + iconColor + '"></i>')

            });   

            console.log(bundleNewElms);

            $('#icon-construct').empty().append(bundleNewElms.reverse().join(" "))    

        }; 

        $('#construct-wrap').sortable({
            handle: '.js-move-trigger',
            update: changeOrder
        }).disableSelection();

     

    } else {
        console.log("somethign went wrong!")
    }
});

</script>

{{/inline}}

{{/layouts/main}}